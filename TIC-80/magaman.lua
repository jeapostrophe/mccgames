-- title:  Magnaman
-- author: Balistic Ghoul Studios
-- desc:   Add on from: MEGAMAN Demo by LuaNX
-- script: lua

z=0
t=0
p={
	x=52,
	y=48,
	xx=0,
	yy=0,
	xv=0,
	yv=0,
	sh=0,
	sl=0,
	st=1,
	exists=0,
	t=0,
	i=0,
	ii=0,
	d=0,
}
b={
	x1=0,
	x2=0,
	x3=0,
	y1=0,
	y2=0,
	y3=0,
	d1=0,
	d2=0,
	d3=0,
	t1=0,
	t2=0,
	t3=0,
}
wall={}			--wall types
wall[2]=1	--1=solid
wall[3]=1 --2=death
wall[1]=2

function tcheck(x,y)
	return wall[mget(x,y)]
end

function bullet(x,y,d)
	if b.t1==0 then
		b.x1=x
		b.y1=y
		b.d1=d
		b.t1=64
		p.sh=12
		sfx(0,50)
	elseif b.t2==0 then
		b.x2=x
		b.y2=y
		b.d2=d
		b.t2=64
		p.sh=12
		sfx(0,50)
	elseif b.t3==0 then
		b.x3=x
		b.y3=y
		b.d3=d
		b.t3=64
		p.sh=12
		sfx(0,50)
	end
end

function player()
	if btn(2) then
		p.xv=-0.6
		p.d=1
	elseif btn(3) then
		p.xv=0.6
		p.d=0
	else
	 p.xv=0
	end
	
	if btnp(4) and p.st==1 then
		p.yv=-1.7
	end
	if btn(4)==false and p.yv<-0 then
	 p.yv=-0
	end
	if btnp(5) then
		bullet(p.x,p.y,p.d)
	end
	
	p.x=p.x+p.xv
	p.y=p.y+p.yv
	
	if p.xv>4 then
	 p.xv=4
	elseif p.xv<-4 then
	 p.xv=-4
	end
	
	if p.yv>4 then
	 p.yv=4
	elseif p.yv<-4 then
	 p.yv=-4
	end
	
	p.xx=math.floor((p.x+4)/8)*8
	p.yy=math.floor((p.y+4)/8)*8
	
	--Right Check:
	if tcheck(p.xx/8+1,p.yy/8)==1 then
	 if p.x>p.xx+2 then
		p.x=p.xx+2
		end
	end
	
	--Left Check:
	if tcheck(p.xx/8-1,p.yy/8)==1 then
	 if p.x<p.xx-2 then
		p.x=p.xx-2
		end
	end
	
	--Floor Check:
	if tcheck(p.xx/8,p.yy/8+1)==1 then
	 if p.y>p.yy+0 then
		p.y=p.yy+0
		p.yv=0
		p.st=1
		sfx(1)
		end
	else
		p.st=0
	end
	if p.st==0 then p.yv=p.yv+0.1 end

	--Ceiling Check:
	if tcheck(p.xx/8,p.yy/8-1)==1 then
	 if p.y<p.yy-2 then
		p.y=p.yy-2
		p.yv=0.1
		end
	end

 --Hazard Check:
	if tcheck(p.xx/8,p.yy/8)==2 then
	 sfx(2)
		p.x=52
		p.y=48
		p.xx=p.x
		p.yy=p.y
		p.xv=0
		p.yv=0
		p.st=1
		p.exists=0
		t=0
	end
	
	if p.st==1 then
		if btn(2) or btn(3) then
			p.i=1
			p.i=p.i+p.ii
		else
			p.i=0
		end
	else
		p.i=3
	end
	if p.sh>0 then p.i=p.i+16 end
	spr(256+p.i,
					(p.x*2)-(mx*16),(p.y*2)-(my*16),
					0,2,p.d
				)
end

function TIC()
	cls(2)
	mx=math.floor(p.xx/8/15)*15
	my=math.floor(p.yy/8/9)*9
	map(mx,my,15,9,0,0,0,2)
	if p.exists==0 then
		
		spr(268+z,p.x*2,(p.y*2)+(math.tan((t+47)/30)),0,2)
	end
	if p.exists==1 then
	 z=0
		player()
	end
	
	if b.t1>0 then
		b.t1=b.t1-1
		spr(264,
			(b.x1*2)-(mx*16),(b.y1*2)-(my*16),
			0,2)
		b.x1=b.x1+((b.d1-0.5)*-4)
	end
	if b.t2>0 then 
		b.t2=b.t2-1
		spr(264,
			(b.x2*2)-(mx*16),(b.y2*2)-(my*16),
			0,2)
		b.x2=b.x2+((b.d2-0.5)*-4)
	end
	if b.t3>0 then 
		b.t3=b.t3-1
		spr(264,
			(b.x3*2)-(mx*16),(b.y3*2)-(my*16),
			0,2)
		b.x3=b.x3+((b.d3-0.5)*-4)
	end
	
	
	
	t=t+1
	p.t=p.t+1
	if p.t==9 then
		p.t=0
		p.ii=p.ii+1
		z=z+1
		if z==4 then p.exists=1 end
	end
	if p.ii==2 then p.ii=0	end
	if p.sh>0 then p.sh=p.sh-1 end
end

-- <TILES>
-- 001:11a111a111a111a111f111f111f111f111f111f11afa1afa1afa1afa1afa1afa
-- 002:444444444ccccccc4999999c4999999c4999999c111111116161616111111111
-- 003:4c16614c4c11114c4c16614c4c11114c4c16614c4c11114c4c16614c4c11114c
-- 004:1111111113111111131111111311111113111111131111111333333111111111
-- 005:000000000000000000000000a000aaaa000000aa0aaaaaaa0000000000000000
-- 006:000000000aaaaa00aaaaaaa0aaaaaaaaaaaaaaaaaaaaaaa00000000000000000
-- 007:000000000000000a000000aa00000a000000a000000a0000000000000a000000
-- 008:a0000000aa000000aaa0a00000aaaa00000aaa0000a000a00a00000000000000
-- 009:1111111113111111131111111388881113d77d1113d7dd1113d77d3111888811
-- 010:0000000000000000000000000088880000d77d0000d7dd0000d77d0000888800
-- 016:113ff311113aa311113ff311113aa311113ff311113aa311113ff311113aa311
-- 017:000000000000000033333333fafafafafafafafa333333330000000000000000
-- 018:000000000000000033333333fafafaf3fafafaf3333333330000000000000000
-- 032:113ff311113aa311113ff311113aa311113ff311113aa311113ff31111333311
-- </TILES>

-- <SPRITES>
-- 000:000888000008c8000008cc0000ddd000080dd800000dd0000080080000800800
-- 001:0000000000008880008d8c8008008cc0000dd080088d08000000800000008000
-- 002:0000888000008c8000008cc0000dd00000088800000dd0000008800000080000
-- 003:000888000808c88000d8cc00000dd000000ddd00000dd0800008080000080000
-- 004:00088000008888000888880000ddd000000dd800000dd8800008080000080000
-- 005:000880000088880000888880000ddd00008dd000088dd0000080800000008000
-- 006:00000000000000000888000008c8000008cc08008ddd808080ddd00008000888
-- 008:000000000000000000000000000ee000000ee000000000000000000000000000
-- 009:0000000000000000000dd00000dffd00000dd000000000000000000000000000
-- 010:0000000000dddd000dffffd00ffffff00dffffd000dddd000000000000000000
-- 011:000000000000000000000000000ff000000ff000000000000000000000000000
-- 012:00088000000880000008800000088000000dd000000dd000000ff000000ff000
-- 013:0000000000088000000000000008800000088000800dd008fddddddf0ffffff0
-- 014:00000000000000000008800000888800008dd8000dddddd0ddffffdd0ddffdd0
-- 015:0000000000088000008cc800008dd800008dd800808dd8080088880008088080
-- 016:000888000008c8000008cc0000dddd88080dd000000dd0000080080000800800
-- 017:0000000000008880008d8c8008008cc0000ddd88088d00000000800000008000
-- 018:0000888000008c8000008cc0000ddd8800088800000dd0000008800000080000
-- 019:000888000808c80000d8cc00000ddd88000ddd00000dd0800008080000080000
-- 020:000888000088c8000808cc0000dddd88000dd000000dd8800008080000080000
-- 021:000888000088c8000808cc0000dddd88000dd000000dd8800008080000080000
-- 022:00000000000000000888000008c8d88008cc00008ddd880080ddd08008000888
-- 024:008008000000000080080008000ff800008ff000800080080000000000800800
-- 025:0000000000000000000ff00000f88f0000f88f00000ff0000000000000000000
-- 026:0000000000ffff000f8008f00f0000f00f0000f00f8008f000ffff0000000000
-- 027:000ff0000f0000f000000000f008800ff008800f000000000f0000f0000ff000
-- 028:0000000000000000000ff00000ffff0000ffff00000ff0000000000000000000
-- 029:0000000000ffff000ff00ff00f0000f00f0000f00ff00ff000ffff0000000000
-- 030:000ff0000f0000f000000000f00ff00ff00ff00f000000000f0000f0000ff000
-- 031:00f00f0000000000f000000f0000000000000000f000000f0000000000f00f00
-- 032:0000000000000000000ee00000ebee000eeebee0003f3f000033330000300300
-- 033:0000000000000000000ee00000ebee000eeebee0003f3f000033330000033000
-- 034:000000000000000000000000000ee00000ebee000eeebee0003f3f0000333300
-- 035:00000000000000000000000000000000000ee00000ebee000eeebee000333300
-- 036:0000000000000000000000000000000000000000000ee00000ebee000eeebee0
-- 048:0000000000000000000080000008000000008000000800000007700000777700
-- 049:0000000000000000000800000000800000080000000080000007700000777700
-- 064:00066600000633000006cc0000fff000060ff600000ff0000060060000600600
-- 065:0000000000006660006f633006006cc0000ff060066f06000000600000006000
-- 066:000066600000633000006cc0000ff00000066600000ff0000006600000060000
-- 067:000666000606336000f6cc00000ff000000fff00000ff0600006060000060000
-- 080:00066600000633000006cc0000ffff66060ff000000ff0000060060000600600
-- 081:0000000000006660006f633006006cc0000fff66066f00000000600000006000
-- 082:000066600000633000006cc0000fff6600066600000ff0000006600000060000
-- 083:000666000606330000f6cc00000fff66000fff00000ff0600006060000060000
-- 096:000110000001100000011000000110000006600000066000000ff000000ff000
-- 097:000000000001100000000000000110000001100010066001f666666f0ffffff0
-- 098:00000000000000000001100000111100001661000666666066ffff66066ff660
-- 099:000000000006600000633600006ff600006ff600606ff6060066660006066060
-- 112:000444000004c4000004cc000044400004045400000440000040040000400400
-- 113:000000000000444000444c4004004cc000045040044404000000400000004000
-- 114:0000444000004c4000004cc00004400000044400000450000004400000040000
-- 115:000444000404c4400044cc000004400000045000000440000040040000400400
-- 116:0005500005000050000000005000000550000005000000000500005000055000
-- 117:0000500005500050000000505000000000000005050000000500055000050000
-- 118:0005500005000050000000005000000550000005000000000500005000055000
-- 119:0005000005000550050000000000000550000000000000500550005000005000
-- 128:000444000004c4000004cc000044444404045000000440000040040000400400
-- 129:0000000000000000000000000005500000055000000005000000000000000000
-- 130:0000000000000000000000000005500000055000005000000000000000000000
-- 131:0000000000000000005000000005500000055000000000000000000000000000
-- 132:0000000000000000000005000005500000055000000000000000000000000000
-- 208:000000000033330003eeef300333333003eeef300333333003eeef3003333330
-- 209:0000000000333300031111300333333003eeef300333333003eeef3003333330
-- 210:031111300333333003eeef300333333003eeef300333333003eeef3003333330
-- 211:0311113003333330031111300333333003111130033333300311113003333330
-- 224:03eeef300333333003eeef300333333003eeef300333333003eeef3003333330
-- 225:00000000003333000311113003333330031111300333333003eeef3003333330
-- 226:0311113003333330031111300333333003eeef300333333003eeef3003333330
-- 227:031111300333333003eeef300333333003d88d30038dd8300033330000000000
-- 240:03eeef300333333003eeef300333333003d88d30038dd8300033330000000000
-- 241:0000000000333300031111300333333003111130033333300311113003333330
-- 242:03111130033333300311113003333330031111300333333003eeef3003333330
-- 243:0311113003333330031111300333333003d88d30038dd8300033330000000000
-- </SPRITES>

-- <MAP>
-- 000:202020202020202020202020202020202020202020202020202020202030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000202020202020202020202020202020
-- 001:200000000000000000000000000040400000000000005060000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304040404040404040404040404020
-- 002:300050600020200000000000000020200000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304040404040404040404040404030
-- 003:300000000070800000000020205030306000000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304040404040404040404040404030
-- 004:201121207000002020200000000030302020000000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304040404040404040402020204020
-- 005:300000300000000000506000000030303030a05060000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000304020202040402020404030404030
-- 006:300000300000000000000000000030303030202000000000000000000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000301010301010103030101030101030
-- 007:300000202020202020202020404030303030303010102000005060000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000202020202020202020202020202020
-- 008:301010303030303030303030404030302020202020202020202020404030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 009:302020202020202020202020404030302020202020202020202040402030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 010:304040404040404040404040404030304040404040404040404040203030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 011:304040404040404040404040404030304040404040404040404020303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 012:304040204040404040404040404030304040401040401040402030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 013:304040302040404040404040404030304020202020202020202020202030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 014:304040303020404040404040404030304040404040404040404040404030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 015:304040303030204040404040404030302020202020202020202020404030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 016:304040303030302020202020101030303030303030303030303030204030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 017:204040202020202020202020202020202020202020202020202020404030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 018:000000000000000000000000000000000000000000000000506000002030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 019:000000005060000000000000000000000000506000000000000000203030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 020:000000000000000000506000000000000000000000000000000020303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 021:708070800000000000000000708000000000000000000000002030303030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 022:007000000020202080000070202020202020000020000020002020202030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 023:000000000000300000000000003000003000007080000000000030000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 024:002020200000300020202000003000003000700000000000000030807030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 025:000030000070300000300000003000003000000000708000007030700030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 026:000030000000300000300000003000003000000070000000000030000030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- 027:101020101010201010201010102010102010101010101010101020101030000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
-- </MAP>

-- <WAVES>
-- 000:ff00000000000000ff00000000000000
-- 001:fff0000000000000fff0000000000000
-- 002:ffffffff00000000ffffffff00000000
-- 003:0123456789abcdeffedcba9876543210
-- </WAVES>

-- <SFX>
-- 000:0009000c000e00010005f006f006f006f007f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000c00000000000
-- 001:700070c0c0c0c000a000a0c0e0c0e000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000f000402000000000
-- 002:1007100520032001300f300d400b40095008500060006000700070008000800090009000a000a000b000b000c000c000d000d000e000e000f000f000c00000000009
-- </SFX>

-- <PALETTE>
-- 000:140c1c44243430346d4e4a4f854c30346524d04648757161597dced27d2c8595a16daa2cd2aa996dc2cadad45edeeed6
-- </PALETTE>

