pico-8 cartridge // http://www.pico-8.com
version 29
__lua__
function _init()
    --particles
    effects = {}

    --effects settings
    trail_width = 1.5
    trail_colors = {8,9,10,11}
    trail_amount = 2

    fire_width = 3
    fire_colors = {8,9,10,5}
    fire_amount = 3

    explode_size = 5
    explode_colors = {8,9,6,5}
    explode_amount = 5

    --sfx
    trail_sfx = 0
    explode_sfx = 1
    fire_sfx = 2

    --player
    player = {x=53, y=53, r=2, c=7}
end

function _update60()
    --update particles
    update_fx()

    --player controls
    if btn(0) then player.x-=1 end
    if btn(1) then player.x+=1 end
    if btn(2) then player.y-=1 end
    if btn(3) then player.y+=1 end

    if btn(4) then
        fire(player.x,player.y,fire_width,fire_colors,fire_amount)
        sfx(fire_sfx)
    end
    if btnp(5) then
        explode(player.x,player.y,explode_size,explode_colors,explode_amount)
        sfx(explode_sfx)
    end

    if btn(0) or btn(1) or btn(2) or btn(3) then
        trail(player.x,player.y,trail_width,trail_colors,trail_amount)
        sfx(trail_sfx)
    end
end

function _draw()
    cls()
    map(16,0)
    
    --draw particles
    draw_fx()

    --player
    circfill(player.x,player.y,player.r,player.c)
end
-->8
-- core particle functions

function add_fx(x,y,die,dx,dy,grav,grow,shrink,r,c_table)
    local fx={
        x=x,
        y=y,
        t=0,
        die=die,
        dx=dx,
        dy=dy,
        grav=grav,
        grow=grow,
        shrink=shrink,
        r=r,
        c=0,
        c_table=c_table
    }
    add(effects,fx)
end

function update_fx()
    for fx in all(effects) do
        --lifetime
        fx.t+=1
        if fx.t>fx.die then del(effects,fx) end

        --color depends on lifetime
        if fx.t/fx.die < 1/#fx.c_table then
            fx.c=fx.c_table[1]

        elseif fx.t/fx.die < 2/#fx.c_table then
            fx.c=fx.c_table[2]

        elseif fx.t/fx.die < 3/#fx.c_table then
            fx.c=fx.c_table[3]

        else
            fx.c=fx.c_table[4]
        end

        --physics
        if fx.grav then fx.dy+=.5 end
        if fx.grow then fx.r+=.1 end
        if fx.shrink then fx.r-=.1 end

        --move
        fx.x+=fx.dx
        fx.y+=fx.dy
    end
end

function draw_fx()
    for fx in all(effects) do
        --draw pixel for size 1, draw circle for larger
        if fx.r<=1 then
            pset(fx.x,fx.y,fx.c)
        else
            circfill(fx.x,fx.y,fx.r,fx.c)
        end
    end
end
-->8
--example particle effects

-- motion trail effect
function trail(x,y,w,c_table,num)

    for i=0, num do
        --settings
        add_fx(
            x+rnd(w)-w/2,  -- x
            y+rnd(w)-w/2,  -- y
            40+rnd(30),  -- die
            0,         -- dx
            0,         -- dy
            false,     -- gravity
            false,     -- grow
            false,     -- shrink
            1,         -- radius
            c_table    -- color_table
        )
    end
end

-- explosion effect
function explode(x,y,r,c_table,num)
    for i=0, num do

        --settings
        add_fx(
            x,         -- x
            y,         -- y
            30+rnd(25),-- die
            rnd(2)-1,  -- dx
            rnd(2)-1,  -- dy
            false,     -- gravity
            false,     -- grow
            true,      -- shrink
            r,         -- radius
            c_table    -- color_table
        )
    end
end

-- fire effect
function fire(x,y,w,c_table,num)
    for i=0, num do
        --settings
        add_fx(
            x+rnd(w)-w/2,  -- x
            y+rnd(w)-w/2,  -- y
            30+rnd(10),-- die
            0,         -- dx
            -.5,       -- dy
            false,     -- gravity
            false,     -- grow
            true,      -- shrink
            2,         -- radius
            c_table    -- color_table
        )
    end
end
-->8
--[[change pal

pal(0, 128,1)
pal(1, 129,1)
pal(2, 130,1)
pal(3, 131,1)
pal(4, 132,1)
pal(5, 133,1)
pal(6, 134,1)
pal(7, 135,1)
pal(8, 136,1)
pal(9, 137,1)
pal(10, 138,1)
pal(11, 139,1)
pal(12, 140,1)
pal(13, 141,1)
pal(14, 142,1)
pal(15, 143,1)

poke(0x5f2e,1)]]
__gfx__
0000000000880090000000d000000d0000000000111111112222222233333333ccccc9cccccccccccccccccccccccccc66666666000000000000000000000000
0000000008088000000010000000d00000000000111111112222222233333333c9ccc999cccccccccccccccccccccccc66696666000000000000000000000000
007007000009980a00d00000d000000000000000111111112222222233333333c999c222ccccccccc5cccccc3ccc3ccc669a9666000000000000000000000000
000770009008a9800100000000d0000000000000111111112222222233333333c222c2ccc5ccccccc55ccccc3c3333039aaaaa96000000000000000000000000
0007700000899a98001000000000000000000000111111112222222233333333a2ccacccc55ccc55555555ccbbbbb77c69aaa966000000000000000000000000
00700700089aaa98010000000000000000000000111111112222222233333333aaacaaacc55cc55555555055bcc3cccc69666966000000000000000000000000
00000000089a9a80000000000000000000000000111111112222222233333333888c888cc555555555555555cc3ccccc66666666000000000000000000000000
00000000008aa8001000000000005500000000001111111122222222333333338ccc8cccc66666666667676ccccccccc66666666000000000000000000000000
000000000000000010000000000577504444444455555555666666667777777700000000c66cc666655566cccccccccc00000000000000000000000000000000
000000000000000001000000005777754444444455555555666666667777777700000000c66ccccc555ccccccccccccc00000000000000000000000000000000
0000000000000000c0000000005777754444444455555555666666667777777700000000c6ccccc555ccccccc0cccccc00000000000000000000000000000000
00000000000000000010000000c577504444444455555555666666667777777700000000cccccc555cccccccc7975ccc00000000000000000000000000000000
0000000000000000000c01000c0c55004444444455555555666666667777777700000000ccccccccccccccccc7979ccc00000000000000000000000000000000
0000000000000000000010cc0c00c0004444444455555555666666667777777700000000ccccccccccccccccc0cccccc00000000000000000000000000000000
00000000000000000000000010c000004444444455555555666666667777777700000000cccccccccccccccccccccccc00000000000000000000000000000000
000000000000000000000000000000004444444455555555666666667777777700000000cccccccccccccccccccccccc00000000000000000000000000000000
000000000000000000000000000000008888888899999999aaaaaaaabbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000008888888899999999aaaaaaaabbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000008888888899999999aaaaaaaabbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000008888888899999999aaaaaaaabbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000008888888899999999aaaaaaaabbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000008888888899999999aaaaaaaabbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000008888888899999999aaaaaaaabbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
000000000000000000000000000000008888888899999999aaaaaaaabbbbbbbb0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccddddddddeeeeeeeeffffffff0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccddddddddeeeeeeeeffffffff0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccddddddddeeeeeeeeffffffff0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccddddddddeeeeeeeeffffffff0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccddddddddeeeeeeeeffffffff0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccddddddddeeeeeeeeffffffff0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccddddddddeeeeeeeeffffffff0000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000ccccccccddddddddeeeeeeeeffffffff0000000000000000000000000000000000000000000000000000000000000000
__map__
3737373737373737373737373737373700000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3736373637363736373637363736373600000000000000000000000000000000050500000505000005050000050500000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3637363736373637363736373637363700000000000000000000000000000000343405053434050534340505343405050000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
3636363636363636363636363636363600000000000000000000000000000000343434343434343434343434343434340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
36363636363636363636363636363636000000000000000000000000000000003434343434343434090a3434343434340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
36363636363636363636363636363636000000000000000000000000000000003434343434343434191a3434343434340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
362536253625362536253625362536250000000000000000000000000000000034343434343434343434343434341b340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2536253625362536253625362536253600000000000000000000000000000000343408340808083434343434343434340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2525252525252525252525252525252500000000000000000000000000000000163408080808080834340707340707340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2525252525252525252525252525252500000000000000000000000000000000161608340808083434343407272707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2525252525252525252525252525252500000000000000000000000000000000161616163434343434340707342727340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2524252425262626262626242524252400000000000000000000000000000000160c16161634343434343407272707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2425242526262626262626262425242500000000000000000000000000000000161616161634341b34340707342727340000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
24242426262626262626262626242424000000000000000000000000000000001616160c1625373737373707272707070000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2424262626262626262626262626242400000000000000000000000000000000252525252537373737373737372727370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
2424262626262626262626262626242400000000000000000000000000000000373737373737373737373737373737370000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__sfx__
010700000771112011087111301108723077130301205723000140272500713007250000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
000300000301007220182300c64013630136300e630146300a6201562007020186200403002610030100161000010006100061000010006100061001610006100000000000000000000000000000000000000000
0110000009610076100c610046300d630076300d6200d620016200c6200b620066200a62009620096200162007610066100661005610016100161000610006100000000000000000000000000000000000000000
